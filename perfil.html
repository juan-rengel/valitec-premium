<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ValiTec MJ ‚Äî Perfil</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" href="base.css">

  <style>
    .form-card { max-width:780px; margin:auto; background:var(--bg-card); padding:20px; border-radius:14px; box-shadow:var(--shadow); }
    .perfil-box { display:flex; flex-direction:column; gap:12px; }
    label { color:var(--text-muted); font-weight:600; }
    .input-field { padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:var(--text); }
    .btn-primary { background:linear-gradient(90deg,var(--primary),var(--secondary)); color:#001; padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700; }
    .page { margin-left:270px; padding:28px; }
    @media(max-width:900px){ .page{ margin-left:0; padding:16px } .sidebar{ transform:translateX(-100%) } .sidebar.open{ transform:translateX(0) } }
  </style>
</head>
<body>

<aside class="sidebar">
  <div class="sidebar-logo">
    <img src="logo.png" alt="ValiTec" />
    <h2>ValiTec</h2>
  </div>
  <nav class="sidebar-menu">
    <a href="dashboard.html"><i class="ri-dashboard-line"></i> Painel</a>
    <a href="produto.html"><i class="ri-price-tag-3-line"></i> Cadastrar Produto</a>
    <a href="Lista-produtos.html"><i class="ri-file-list-line"></i> Lista de Produtos</a>
    <a href="Lista-rebaixados.html"><i class="ri-discount-percent-line"></i> Rebaixados</a>
    <a href="calendario.html"><i class="ri-calendar-line"></i> Calend√°rio</a>
    <a href="perfil.html" class="active"><i class="ri-user-line"></i> Perfil</a>
    <a href="cadastro-usuarios.html"><i class="ri-group-line"></i> Usu√°rios</a>
    <a href="relatorios.html"><i class="ri-bar-chart-line"></i> Relat√≥rios</a>
    <a href="#" onclick="localStorage.clear(); location.href='index.html'" class="logout"><i class="ri-logout-box-line"></i> Sair</a>
  </nav>
</aside>

<header class="header">
  <button class="menu-btn" onclick="toggleSidebar()"><i class="ri-menu-line"></i></button>
  <h1>Configura√ß√µes do Perfil</h1>
  <div class="header-user"><i class="ri-user-line"></i></div>
</header>

<section class="page">
  <div class="form-card">
    <form id="formPerfil" class="perfil-box">
      <label for="whatsGerente">WhatsApp do Gerente</label>
      <input type="text" id="whatsGerente" class="input-field" placeholder="Ex: 55929988001122">

      <label for="whatsResponsavel">WhatsApp do Respons√°vel pela Rebaixa</label>
      <input type="text" id="whatsResponsavel" class="input-field" placeholder="Ex: 5592991234567">

      <div style="display:flex;gap:10px;margin-top:6px">
        <button id="salvarPerfil" class="btn-primary">üíæ Salvar Altera√ß√µes</button>
        <button type="button" id="btnLimparPerfil" class="btn-outline">Limpar</button>
      </div>
    </form>
  </div>
</section>

<script>
function toggleSidebar() {
  if (window.innerWidth <= 900) {
    document.querySelector('.sidebar').classList.toggle('open');
  }
}
</script>

<!-- JS ORIGINAL: autentica√ß√£o + Firestore (mantive IDs e l√≥gica intactos) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDPIlkTLbaeUiuvfvijWf5fofREw5oE8ic",
  authDomain: "valitec-mj.firebaseapp.com",
  projectId: "valitec-mj",
  storageBucket: "valitec-mj.firebasestorage.app",
  messagingSenderId: "616592039657",
  appId: "1:616592039657:web:3827a890474111be85da78"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let lojaAtual = null;
let usuarioAtual = null;

onAuthStateChanged(auth, async (user) => {
  if (!user) return;
  usuarioAtual = user.email;

  const userSnap = await getDoc(doc(db, "usuarios", user.email));
  lojaAtual = userSnap.exists() ? userSnap.data().loja : localStorage.getItem('lastSelectedLoja');

  const confSnap = await getDoc(doc(db, `lojas/${lojaAtual}/config/geral`));
  if (confSnap.exists()) {
    document.getElementById("whatsGerente").value = confSnap.data().whatsGerente || "";
    document.getElementById("whatsResponsavel").value = confSnap.data().whatsResponsavel || "";
  }
});

// Salvar altera√ß√µes (mantive o ID salvarPerfil)
document.getElementById("salvarPerfil").onclick = async (e) => {
  e.preventDefault();
  const whatsGerente = document.getElementById("whatsGerente").value.replace(/\D/g, "");
  const whatsResponsavel = document.getElementById("whatsResponsavel").value.replace(/\D/g, "");
  if (!lojaAtual) return alert("‚ö†Ô∏è N√£o foi poss√≠vel identificar sua loja.");
  await setDoc(doc(db, `lojas/${lojaAtual}/config/geral`), { whatsGerente, whatsResponsavel }, { merge: true });
  await setDoc(doc(db, "gerentes", usuarioAtual), { whatsGerente, whatsResponsavel }, { merge: true });
  alert("‚úÖ Configura√ß√µes salvas com sucesso!");
};

// limpar
document.getElementById('btnLimparPerfil').onclick = ()=>{
  document.getElementById('whatsGerente').value='';
  document.getElementById('whatsResponsavel').value='';
};
</script>

<!-- Particle background kept (same effect) -->
<script>
const canvas = document.getElementById("particleCanvas");
if (canvas) {
  const ctx = canvas.getContext("2d");
  let particles = [];
  let w, h;
  function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }

  window.addEventListener('resize', resize); resize();
  for (let i = 0; i < 60; i++) particles.push({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*2+1, dx:(Math.random()-0.5)*0.4, dy:(Math.random()-0.5)*0.4 });
  function draw(){ ctx.clearRect(0,0,w,h); ctx.fillStyle='rgba(0,200,255,0.35)'; particles.forEach(p=>{ ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }); connect(); move(); requestAnimationFrame(draw); }
  function move(){ particles.forEach(p=>{ p.x+=p.dx; p.y+=p.dy; if(p.x<0||p.x>w)p.dx*=-1; if(p.y<0||p.y>h)p.dy*=-1; }); }
  function connect(){ ctx.strokeStyle='rgba(0,200,255,0.10)'; ctx.lineWidth=1; for(let i=0;i<particles.length;i++) for(let j=i+1;j<particles.length;j++){ let d=Math.hypot(particles[i].x-particles[j].x, particles[i].y-particles[j].y); if(d<130){ ctx.globalAlpha=1-d/130; ctx.beginPath(); ctx.moveTo(particles[i].x,particles[i].y); ctx.lineTo(particles[j].x,particles[j].y); ctx.stroke(); } } ctx.globalAlpha=1; }
  draw();
}
</script>

<!-- hamburger helper -->
<script>
const sidebar = document.querySelector('.sidebar');
const hamburger = document.createElement('button');
hamburger.className = 'hamburger';
hamburger.textContent = '‚ò∞';
hamburger.onclick = () => sidebar.classList.toggle('open');
document.body.appendChild(hamburger);
</script>

</body>
</html>
