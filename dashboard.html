<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ValiTec</title>
<link rel="stylesheet" href="base.css">

<style>
  @media (max-width: 900px) {
    .page { margin-left: 250px; }
}
/* ==========================================================
   ValiTec ‚Äî Dashboard (estiliza√ß√£o adicional)
   Compat√≠vel 100% com seu base.css
   ========================================================== */

/* ----- Ajuste do header do Dashboard ----- */
header.page {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 10px;
    margin-bottom: 10px;
}

header.page .page-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary);
    text-shadow: 0 0 12px var(--primary-glow);
    display: flex;
    align-items: center;
    gap: 10px;
}

/* ----- Usu√°rio no canto ----- */
.header-user {
    background: rgba(0, 194, 255, 0.15);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 18px;
    color: var(--primary);
    box-shadow: 0 0 10px var(--primary-glow);
}

/* ----------------------------------------------------------
   KPI CARDS ‚Äî Neon Azul Futurista (m√©dio)
   ---------------------------------------------------------- */

.kpi {
    background: linear-gradient(160deg, #071524, #0b1c33);
    border: 1px solid rgba(0, 194, 255, 0.18);
    border-radius: 14px;
    padding: 18px;
    min-height: 110px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;

    /* brilho suave */
    box-shadow: 0 8px 22px rgba(0, 194, 255, 0.08),
                inset 0 0 30px rgba(0, 194, 255, 0.03);
    transition: 0.25s ease;
}

.kpi:hover {
    transform: translateY(-6px);
    box-shadow: 0 14px 40px rgba(0, 194, 255, 0.18);
}

/* T√≠tulo do n√∫mero */
.kpi h2 {
    font-size: 32px;
    color: #e9faff;
    margin-bottom: 6px;
    text-shadow: 0 0 10px rgba(0, 194, 255, 0.25);
}

/* Subt√≠tulo */
.kpi span {
    font-size: 14px;
    color: var(--text-muted);
    letter-spacing: 0.2px;
}

/* √çcones decorativos */
.kpi::after {
    content: "üìä";
    position: absolute;
    right: 12px;
    top: 8px;
    font-size: 26px;
    opacity: 0.28;
}

/* √çcones diferentes por card */
#totalProdutos::after { content: "üì¶"; }
#vencidos::after { content: "‚ö†Ô∏è"; }
#vencendoHoje::after { content: "‚è≥"; }
#pertoVencer::after { content: "üîª"; }

/* ----------------------------------------------------------
   BOT√ÉO RESUMO POR SETOR
   ---------------------------------------------------------- */

.btn-abrir-setor {
    background: linear-gradient(90deg, var(--primary), #0095ff);
    color: #001;
    padding: 12px 16px;
    font-weight: 600;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 0 14px var(--primary-glow);
    margin-top: 15px;
    transition: 0.25s;
}

.btn-abrir-setor:hover {
    transform: scale(1.05);
    filter: brightness(1.12);
}

/* ----------------------------------------------------------
   MODAL SETOR (visual futurista)
   ---------------------------------------------------------- */

.modal-setor {
    backdrop-filter: blur(6px);
}

.modal-setor > div {
    background: linear-gradient(160deg, #081626, #091b30);
    border: 1px solid rgba(0, 194, 255, 0.25);
    box-shadow: 0 12px 40px rgba(0, 194, 255, 0.3);
    border-radius: 14px;
}

#fecharSetor {
    background: #ff4d6d !important;
    width: 100%;
    margin-top: 16px;
    font-weight: 600;
    border-radius: 10px;
    transition: 0.25s;
}

#fecharSetor:hover {
    transform: scale(1.04);
    filter: brightness(1.15);
}

/* ----------------------------------------------------------
   GRID AJUSTADA PARA DESKTOP E MOBILE
   ---------------------------------------------------------- */

.grid.grid-3 {
    gap: 18px;
}

/* Mobile */
@media (max-width: 600px) {
    .kpi {
        min-height: 90px;
        padding: 14px;
    }
    .kpi h2 {
        font-size: 26px;
    }
}



</style>
</head>

<body>

<div class="menu-acima">
</div>
<!-- Aqui vou aplicar o novo MENU + HEADER -->

<!-- SIDEBAR - MENU VALITEC -->
<aside class="sidebar">
    <div class="sidebar-logo">
        
        <h2>ValiTec</h2>
    </div>

    <nav class="sidebar-menu">
        <a href="dashboard.html" class="active"><i class="ri-dashboard-line"></i> Dashboard</a>
        <a href="produto.html"><i class="ri-price-tag-3-line"></i> Cadastrar Produtos</a>
        <a href="Lista-produtos.html"><i class="ri-file-list-line"></i> Lista de Produtos</a>
        <a href="Painel-rebaixa.html"><i class="ri-discount-percent-line"></i> Rebaixas</a>
        <a href="cadastro-usuarios.html"><i class="ri-user-lineline"></i> Usu√°rios</a>
        <a href="relatorios.html"><i class="ri-bar-chart-line"></i> Relat√≥rios</a>
        <a href="perfil.html"><i class="icon-user"></i> Perfil</a>
        <a href="index.html" class="logout"><i class="ri-logout-box-line"></i> Sair</a>
    </nav>
</aside>

<!-- HEADER -->
<header class="page">

    <h1 class="page-title">Dashboard</h1>
    <div class="header-user"><i class="icon-user"></i></div>
</header>

<!-- CONTE√öDO DA P√ÅGINA -->
<section class="main">
    <h2 class="title neon">Vis√£o Geral</h2>
    <div class="grid grid-3">

        <div class="kpi">
            <h2 id="totalProdutos">0</h2>
            <span>Total de Produtos</span>
        </div>

        <div class="kpi">
            <h2 id="vencidos">0</h2>
            <span>Produtos Vencidos</span>
        </div>

        <div class="kpi">
            <h2 id="vencendoHoje">0</h2>
            <span>Vencendo Hoje</span>
        </div>

        <div class="kpi">
            <h2 id="pertoVencer">0</h2>
            <span>Perto de Vencer ( <= 5 dias)</span>
        </div>

    </div>

    <!-- BOT√ÉO PARA ABRIR O RESUMO POR SETOR -->
<button id="abrirSetor" class="btn-abrir-setor">Resumo por Setor</button>

<!-- MODAL DE SETORES -->
<div id="modalSetor" class="modal-setor" style="
    display:none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
">
    <div style="
        background: #1a1a1a;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 400px;
        text-align: center;
        color: white;
    ">
        <h2>Resumo por Setor</h2>

        <canvas id="graficoSetoresModal" width="300" height="300"></canvas>

        <button id="fecharSetor"
            style="
            margin-top: 20px;
            padding: 10px 20px;
            background: #ff5c5c;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        ">Fechar</button>
    </div>
</div>
</section>

<script>
function toggleSidebar() {
  if (window.innerWidth <= 900) {
    document.querySelector('.sidebar').classList.toggle('open');
  }
}
</script>


  <script src="chart.js"></script>


  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDPIlkTLbaeUiuvfvijWf5fofREw5oE8ic",
    authDomain: "valitec-mj.firebaseapp.com",
    projectId: "valitec-mj",
    storageBucket: "valitec-mj.firebasestorage.app",
    messagingSenderId: "616592039657",
    appId: "1:616592039657:web:3827a890474111be85da78"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let lojaAtual = null;
  let graficoSetor = null;

  // === Fun√ß√£o para ocultar "Cadastrar Usu√°rios" se n√£o for master ===
  function ocultarMenuPorCargo(cargo) {
    const linkCadastro = document.querySelector("a[href='cadastro-usuarios.html']");
    if (!linkCadastro) return;

    if (cargo !== "master") {
      linkCadastro.style.display = "none";
    }
  }

  // === Carregar loja do usu√°rio logado ===
  onAuthStateChanged(auth, async (user) => {
    if (!user) return;

    const snap = await getDoc(doc(db, "usuarios", user.email));
    if (!snap.exists()) return;

    lojaAtual = snap.data().loja;
    const cargo = snap.data().cargo;

    // Aplica oculta√ß√£o do menu ‚úî
    ocultarMenuPorCargo(cargo);

    carregarIndicadores();
  });

  // === Indicadores principais ===
  async function carregarIndicadores() {
    if (!lojaAtual) return;

    const ref = collection(db, `lojas/${lojaAtual}/produtos`);
    const snap = await getDocs(ref);

    let total = 0, vencidos = 0, vencendoHoje = 0, pertoVencer = 0;
    const hoje = new Date();

    snap.forEach(docItem => {
      const p = docItem.data();
      if (!p.dataValidadeISO) return;

      total++;
      const validade = new Date(p.dataValidadeISO);
      const diff = Math.ceil((validade - hoje) / (1000 * 60 * 60 * 24));

      if (diff < 0) vencidos++;
      else if (diff === 0) vencendoHoje++;
      else if (diff <= 5) pertoVencer++;
    });

    document.getElementById("totalProdutos").textContent = total;
    document.getElementById("vencidos").textContent = vencidos;
    document.getElementById("vencendoHoje").textContent = vencendoHoje;
    document.getElementById("pertoVencer").textContent = pertoVencer;
  }

  // === Gr√°fico Setor ===
  async function abrirResumoSetor() {
    if (!lojaAtual) return alert("Loja n√£o identificada.");
    const modal = document.getElementById("modalSetor");
    modal.style.display = "flex";

    const ref = collection(db, `lojas/${lojaAtual}/produtos`);
    const snap = await getDocs(ref);

    const setores = {};
    snap.forEach(docItem => {
      const p = docItem.data();
      if (!p.setor) return;
      setores[p.setor] = (setores[p.setor] || 0) + 1;
    });

    const ctx = document.getElementById("graficoSetoresModal").getContext("2d");
    if (graficoSetor) graficoSetor.destroy();

    graficoSetor = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(setores),
        datasets: [{
          data: Object.values(setores),
          backgroundColor: ["#00C8FF","#4EFF9A","#FFD700","#FF6B6B","#9B5DE5","#F15BB5","#00BBF9"]
        }]
      },
      options: {
        plugins: { legend: { labels: { color: '#fff' } } }
      }
    });
  }

  document.getElementById("abrirSetor").addEventListener("click", abrirResumoSetor);
  document.getElementById("fecharSetor").addEventListener("click", () => {
    document.getElementById("modalSetor").style.display = "none";
  });
  </script>

  <script>

  // --- Fundo de part√≠culas ---
  const canvas = document.getElementById('particleCanvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
    window.addEventListener('resize', resize); resize();
    const particles = Array.from({length:60},()=>({
      x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2+1,
      sx:(Math.random()-0.5)*0.6,sy:(Math.random()-0.5)*0.6
    }));
    function animate(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach(p=>{
        p.x+=p.sx;p.y+=p.sy;
        if(p.x<0)p.x=canvas.width;if(p.x>canvas.width)p.x=0;
        if(p.y<0)p.y=canvas.height;if(p.y>canvas.height)p.y=0;
        ctx.fillStyle='rgba(255,255,255,0.07)';
        ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();
      });
      requestAnimationFrame(animate);
    }
    animate();
  }



</script>

<script>
const sidebar = document.querySelector('.sidebar');
const hamburger = document.createElement('button');
hamburger.className = 'hamburger';
hamburger.textContent = '‚ò∞';
hamburger.onclick = () => {
  sidebar.classList.toggle('open');
};
document.body.appendChild(hamburger);
</script>


</body>
</html>
